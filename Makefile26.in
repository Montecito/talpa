
EXTRA_CFLAGS += -I$(src)/src -I$(src)/src/ifaces -I$(src)/include ${TALPA_ID} @debug@ @inodeallocsem@ @tasknewtty@ @lsm265@ @lsm266@ @lsm2610@ @hidden@ @execve@ @xhack@

obj-m := talpa_linux.o talpa_core.o talpa_vcdevice.o talpa_pedevice.o talpa_pedconnector.o talpa_vfshook.o talpa_syscallhook.o talpa_syscall.o

ifeq "@buildlsm@" "yes"
	obj-m += stacker.o talpa_capability.o talpa_lsm.o
endif

include $(src)/src/app-ctrl/core/talpa-linux/common.mk
talpa_linux-objs := $(talpaLinuxOBJS)

include $(src)/src/app-ctrl/core/talpa-core/common.mk
talpa_core-objs :=  $(talpaCoreOBJS)

include $(src)/src/app-ctrl/filter-iface/vetting-clients/talpa-vcdevice/common.mk
talpa_vcdevice-objs :=  $(talpaVcdeviceOBJS)

include $(src)/src/app-ctrl/filter-iface/process-exclusion/talpa-pedevice/common.mk
talpa_pedevice-objs :=  $(talpaPedeviceOBJS)

include $(src)/src/platforms/linux/talpa_pedconnector/common.mk
talpa_pedconnector-objs := $(talpaPEDConnectorOBJS)

include $(src)/src/platforms/linux/talpa_syscallhook/common.mk
talpa_syscallhook-objs := $(talpaSyscallHookOBJS)

include $(src)/src/app-ctrl/intercepts/talpa-syscall/common.mk
talpa_syscall-objs :=   $(talpaSyscallOBJS)

include $(src)/src/app-ctrl/intercepts/talpa-vfshook/common.mk
talpa_vfshook-objs :=   $(talpaVFSHookOBJS)

ifeq "@buildlsm@" "yes"
	include $(src)/support/stacker/common.mk
	stacker-objs := $(talpaStackerOBJS)
	
	include $(src)/src/platforms/linux/talpa_capability/common.mk
	talpa_capability-objs := $(talpaCapabilityOBJS)

	include $(src)/src/app-ctrl/intercepts/talpa-lsm/common.mk
	talpa_lsm-objs :=   $(talpaLsmOBJS)
endif

# Hidden by makefile, which is run in preference.  If makefile doesn't exist,
# then we shall cry foul.
all:
	@echo "Please run 'configure' before building."
	@exit 1
